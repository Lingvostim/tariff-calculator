<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Калькулятор тарифов</title>
  <style>
    :root{
      --bg: #0b1020;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --line: rgba(255,255,255,.14);
      --accent: #7c5cff;
      --accent2:#22c55e;
      --danger:#ef4444;
      --shadow: 0 20px 60px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(124,92,255,.25), transparent 55%),
        radial-gradient(900px 600px at 85% 20%, rgba(34,197,94,.18), transparent 50%),
        radial-gradient(1200px 900px at 50% 100%, rgba(255,255,255,.06), transparent 60%),
        var(--bg);
      min-height:100vh;
      padding: 28px 16px;
    }

    .wrap{max-width: 980px; margin: 0 auto;}
    header{
      display:flex; align-items:flex-end; justify-content:space-between; gap:16px;
      margin-bottom: 18px;
    }
    h1{
      font-size: clamp(20px, 3vw, 28px);
      margin:0;
      letter-spacing: .2px;
    }
    .hint{color:var(--muted); margin: 6px 0 0 0; font-size: 13px;}

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    @media (min-width: 860px){
      .grid{grid-template-columns: 360px 1fr;}
    }

    .card{
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.04));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .head{
      padding: 16px 16px 12px 16px;
      border-bottom: 1px solid var(--line);
      background: rgba(255,255,255,.03);
    }
    .card .head h2{
      margin:0;
      font-size: 14px;
      color: var(--muted);
      font-weight: 600;
      letter-spacing: .25px;
      text-transform: uppercase;
    }
    .card .body{padding: 16px;}

    .form{
      display:grid;
      gap: 12px;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap: 6px;
    }
    label{color: var(--muted); font-size: 13px;}
    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.2);
      color: var(--text);
      outline: none;
    }
    input:focus{border-color: rgba(124,92,255,.7); box-shadow: 0 0 0 4px rgba(124,92,255,.18);}
    .help{color: var(--muted); font-size: 12px; margin-top: 2px;}

    .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 6px;
    }
    button{
      border: 0;
      cursor: pointer;
      padding: 12px 14px;
      border-radius: 14px;
      color: white;
      font-weight: 700;
      letter-spacing: .2px;
      background: linear-gradient(135deg, rgba(124,92,255,1), rgba(124,92,255,.75));
      box-shadow: 0 10px 24px rgba(124,92,255,.25);
    }
    button.secondary{
      background: rgba(255,255,255,.08);
      box-shadow: none;
      border: 1px solid rgba(255,255,255,.16);
      color: var(--text);
      font-weight: 600;
    }
    button:active{transform: translateY(1px);}

    .status{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size: 13px;
    }
    .status.error{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.08);
      color: rgba(255,255,255,.85);
    }

    .summary{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 0 0 12px 0;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size: 13px;
      white-space: nowrap;
    }
    .pill b{color: var(--text); font-weight: 800;}

    .tableWrap{
      overflow:auto;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
    }
    table{
      width:100%;
      border-collapse: collapse;
      min-width: 520px;
    }
    thead th{
      text-align:left;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .2px;
      padding: 12px 12px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    tbody td{
      padding: 12px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      color: rgba(255,255,255,.88);
    }
    tbody tr:hover td{background: rgba(255,255,255,.03);}
    td.num{font-variant-numeric: tabular-nums;}
    td.right{text-align:right;}
    .totalRow td{
      background: rgba(34,197,94,.08);
      border-bottom: 0;
      font-weight: 800;
    }

    footer{
      margin-top: 18px;
      color: var(--muted);
      font-size: 12px;
    }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Калькулятор тарифов</h1>
        <p class="hint">Вводишь параметры — получаешь таблицу цен от минимума до максимума мест.</p>
      </div>
      <div class="pill"><span class="mono">N × Цена</span></div>
    </header>

    <div class="grid">
      <!-- LEFT: FORM -->
      <section class="card">
        <div class="head"><h2>Параметры</h2></div>
        <div class="body">
          <div class="form" id="form">
            <div class="row">
              <label for="places">Количество мест (max)</label>
              <input id="places" type="number" inputmode="numeric" min="1" step="1" value="20" />
              <div class="help">Например: 6, 8, 10, 15, 20…</div>
            </div>

            <div class="row">
              <label for="price">Цена за человека (₽)</label>
              <input id="price" type="number" inputmode="numeric" min="0" step="1" value="640" />
              <div class="help">Только число, без пробелов.</div>
            </div>

            <div class="row">
              <label for="minPeople">Минимальное количество Гостей</label>
              <input id="minPeople" type="number" inputmode="numeric" min="1" step="1" value="3" />
              <div class="help">Таблица начнётся с этого значения.</div>
            </div>

            <div class="actions">
              <button id="calcBtn" type="button">Рассчитать</button>
              <button id="copyBtn" class="secondary" type="button">Скопировать CSV</button>
              <button id="resetBtn" class="secondary" type="button">Сброс</button>
            </div>

            <div class="status" id="status">Готово. Нажми “Рассчитать”.</div>
          </div>
        </div>
      </section>

      <!-- RIGHT: RESULT -->
      <section class="card">
        <div class="head"><h2>Результат</h2></div>
        <div class="body">
          <div class="summary" id="summary">
            <div class="pill">Мест: <b id="sPlaces">—</b></div>
            <div class="pill">Цена/чел: <b id="sPrice">—</b></div>
            <div class="pill">Мин.: <b id="sMin">—</b></div>
            <div class="pill">Итого (max): <b id="sMaxTotal">—</b></div>
          </div>

          <div class="tableWrap">
            <table aria-label="Таблица цен">
              <thead>
                <tr>
                  <th style="width: 30%;">Кол-во человек</th>
                  <th style="width: 35%;" class="right">Цена за 1 чел., ₽</th>
                  <th style="width: 35%;" class="right">Итоговая стоимость, ₽</th>
                </tr>
              </thead>
              <tbody id="tbody">
                <!-- rows injected -->
              </tbody>
            </table>
          </div>

          <footer>
          </footer>
        </div>
      </section>
    </div>
  </div>

  <script>
    const el = (id) => document.getElementById(id);

    const places = el("places");
    const price = el("price");
    const minPeople = el("minPeople");

    const status = el("status");
    const tbody = el("tbody");

    const sPlaces = el("sPlaces");
    const sPrice = el("sPrice");
    const sMin = el("sMin");
    const sMaxTotal = el("sMaxTotal");

    const fmt = new Intl.NumberFormat("ru-RU");

    function setStatus(text, isError=false){
      status.textContent = text;
      status.classList.toggle("error", isError);
    }

    function validateInputs(maxPlaces, pricePerPerson, minP){
      if (!Number.isInteger(maxPlaces) || maxPlaces < 1) return "Количество мест должно быть целым числом ≥ 1";
      if (!Number.isInteger(pricePerPerson) || pricePerPerson < 0) return "Цена за человека должна быть целым числом ≥ 0";
      if (!Number.isInteger(minP) || minP < 1) return "Минимальное количество должно быть целым числом ≥ 1";
      if (minP > maxPlaces) return "Минимальное количество не может быть больше количества мест";
      return null;
    }

    function buildTable(maxPlaces, pricePerPerson, minP){
      tbody.innerHTML = "";

      for (let n = minP; n <= maxPlaces; n++){
        const total = n * pricePerPerson;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="num">${fmt.format(n)}</td>
          <td class="num right">${fmt.format(pricePerPerson)}</td>
          <td class="num right">${fmt.format(total)}</td>
        `;
        tbody.appendChild(tr);
      }

      // итоговая строка (для max)
      const totalMax = maxPlaces * pricePerPerson;
      const trTotal = document.createElement("tr");
      trTotal.className = "totalRow";
      trTotal.innerHTML = `
        <td>Итого за ${fmt.format(maxPlaces)} чел.</td>
        <td class="right">—</td>
        <td class="num right">${fmt.format(totalMax)}</td>
      `;
      tbody.appendChild(trTotal);

      // summary
      sPlaces.textContent = fmt.format(maxPlaces);
      sPrice.textContent = fmt.format(pricePerPerson) + " ₽";
      sMin.textContent = fmt.format(minP);
      sMaxTotal.textContent = fmt.format(totalMax) + " ₽";
    }

    function calculate(){
      const maxPlaces = Number(places.value);
      const pricePerPerson = Number(price.value);
      const minP = Number(minPeople.value);

      const err = validateInputs(maxPlaces, pricePerPerson, minP);
      if (err){
        setStatus(err, true);
        tbody.innerHTML = "";
        sPlaces.textContent = sPrice.textContent = sMin.textContent = sMaxTotal.textContent = "—";
        return;
      }

      buildTable(maxPlaces, pricePerPerson, minP);
      setStatus("Готово: таблица обновлена.", false);
    }

    function toCSV(){
      const maxPlaces = Number(places.value);
      const pricePerPerson = Number(price.value);
      const minP = Number(minPeople.value);
      const err = validateInputs(maxPlaces, pricePerPerson, minP);
      if (err){ setStatus(err, true); return; }

      let csv = "people,price_per_person,total\n";
      for (let n = minP; n <= maxPlaces; n++){
        csv += `${n},${pricePerPerson},${n * pricePerPerson}\n`;
      }
      csv += `max_total,,${maxPlaces * pricePerPerson}\n`;
      return csv;
    }

    async function copyCSV(){
      const csv = toCSV();
      if (!csv) return;
      try{
        await navigator.clipboard.writeText(csv);
        setStatus("CSV скопирован в буфер обмена.", false);
      }catch(e){
        setStatus("Не удалось скопировать CSV (браузер запретил доступ к буферу).", true);
      }
    }

    function reset(){
      places.value = 20;
      price.value = 640;
      minPeople.value = 3;
      calculate();
      setStatus("Сброшено к значениям по умолчанию.", false);
    }

    // кнопки
    el("calcBtn").addEventListener("click", calculate);
    el("copyBtn").addEventListener("click", copyCSV);
    el("resetBtn").addEventListener("click", reset);

    // авто-обновление при вводе
    ["input","change"].forEach(evt => {
      [places, price, minPeople].forEach(inp => inp.addEventListener(evt, () => {
        // мягко: не спамим ошибками на пустом поле
        if (inp.value === "") return;
        calculate();
      }));
    });

    // стартовый расчёт
    calculate();
  </script>
</body>
</html>

